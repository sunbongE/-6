# 04.클래스의 분리



![image-20241114233218691](images.assets/04_image.png)

두가지 클래스를 상속을 하지않고, 분리할 것이다.(의존관계)

- **PaymentService**

  - abstract제거
  - 사용하는 클래스 싱글톤 적용.

  ```java
  import java.io.IOException;
  import java.math.BigDecimal;
  import java.time.LocalDateTime;
  
  public class PaymentService {
          private final SimpleExRateProvider exRateProvider;
          public PaymentService(){
              this.exRateProvider = new SimpleExRateProvider();
          }
  
      public Payment prepare(Long orderId, String currency, BigDecimal foreignCurrencyAmount) throws IOException {
          BigDecimal exRate = exRateProvider.getExRate(currency);
          BigDecimal convertedAmount = foreignCurrencyAmount.multiply(exRate);
          LocalDateTime validUntil = LocalDateTime.now().plusMinutes(30);
  
          return new Payment(orderId, currency, foreignCurrencyAmount, exRate, convertedAmount, validUntil);
      }
  }
  ```

- **SimpleExRateProvider, WebApiExRateProvider**

  상속을 제거하고, 클래스를 분리시켰다.

  ```java
  public class SimpleExRateProvider {
  
      BigDecimal getExRate(String currency) throws IOException {
          if(currency.equals("USD")) return BigDecimal.valueOf(1000);
  
          throw new IllegalArgumentException("지원하지 않는 통화입니다.");
      }
  }
  
  ------------------------------------------------------------- 
  public class WebApiExRateProvider {
  
      BigDecimal getExRate(String currency) throws IOException {
          URL url = new URL("<https://open.er-api.com/v6/latest/>" + currency);
          HttpURLConnection connection = (HttpURLConnection) url.openConnection();
          BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream()));
          String response = br.lines().collect(Collectors.joining());
          br.close();
  
          ObjectMapper mapper = new ObjectMapper();
          ExRateData data = mapper.readValue(response, ExRateData.class);
          return data.rates().get("KRW");
      }
  }
  ```

여전한 문제점은 **PaymentService에서** 사용하는 provider가 달라질때마다 싱글톤 적용부분 수정이 필요하다는 점과 두 Provider의 메서드 명이 다르면 또 변경이 필요하다 → 번거로움 → 이름을 통일하고, 변경 안 하고 싶음 이문제를 해결하기위해 다음시간에는 **인터페이스를 도입**한다.
