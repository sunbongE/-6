# 05.인터페이스 도입

인터페이스를 통해서 동일한 이름으로 사용하고 확장 할 수 있게함. 재사용성이 좋아질거같다.

![image-20241114233336238](images.assets/05_image.png)

- 인터페이스 생성.

  ```java
  package tobyspring.hellospring;
  
  import java.io.IOException;
  import java.math.BigDecimal;
  
  public interface ExRateProvider {
      BigDecimal getExRate(String currency) throws IOException;
  }
  ```

- 인터페이스 구현

  ```java
  public class SimpleExRateProvider implements ExRateProvider{
  
      @Override
      public BigDecimal getExRate(String currency) throws IOException {
          if(currency.equals("USD")) return BigDecimal.valueOf(1000);
  
          throw new IllegalArgumentException("지원하지 않는 통화입니다.");
      }
  }
  --------------------------------------------------------------------------
  public class WebApiExRateProvider implements ExRateProvider{
  
      @Override
      public BigDecimal getExRate(String currency) throws IOException {
          URL url = new URL("<https://open.er-api.com/v6/latest/>" + currency);
          HttpURLConnection connection = (HttpURLConnection) url.openConnection();
          BufferedReader br = new BufferedReader(new InputStreamReader(connection.getInputStream()));
          String response = br.lines().collect(Collectors.joining());
          br.close();
  
          ObjectMapper mapper = new ObjectMapper();
          ExRateData data = mapper.readValue(response, ExRateData.class);
          return data.rates().get("KRW");
      }
  }
  ```

- **PaymentService**

  ```java
  public class PaymentService {
          private final ExRateProvider exRateProvider;
          public PaymentService(){
  //            this.exRateProvider = new SimpleExRateProvider(); // 이부분만 수정해서 사용할수이따.
              this.exRateProvider = new WebApiExRateProvider();
          }
  
      public Payment prepare(Long orderId, String currency, BigDecimal foreignCurrencyAmount) throws IOException {
          BigDecimal exRate = exRateProvider.getExRate(currency);
          BigDecimal convertedAmount = foreignCurrencyAmount.multiply(exRate);
          LocalDateTime validUntil = LocalDateTime.now().plusMinutes(30);
  
          return new Payment(orderId, currency, foreignCurrencyAmount, exRate, convertedAmount, validUntil);
      }
  }
  ```

인터페이스를 적용해 다형성을 이용해서 인스턴스를 생성해 사용할 수 있고, 메서드 이름도 같기때문에 따로 변경이 필요없다. 하지만 여전히 변경해야하는 부분이 있고, 결합도가 높은 것을 알 수 있다. 다음 시간에는 이 결합도를 낮추는 방법을 알아보자.

```java
//this.exRateProvider = new SimpleExRateProvider(); // 이부분만 수정해서 사용할수이따.
this.exRateProvider = new WebApiExRateProvider();
```